{% extends 'base.html' %}
{% block title %}{{ 'New Session' if not session else 'Edit Session' }}{% endblock %}
{% block content %}
<h1>{{ 'New Session' if not session else 'Edit Session' }}</h1>
<form method="post">
  <div><label>Title <input type="text" name="title" value="{{ session.title if session else '' }}"></label></div>
  <div><label>Workshop Type
    <select name="workshop_type_id" required>
      <option value="">--Select--</option>
      {% for wt in workshop_types %}
      <option value="{{ wt.id }}" {% if session and session.workshop_type_id==wt.id %}selected{% endif %}>{{ wt.code }}</option>
      {% endfor %}
    </select>
  </label></div>
  <div><label>Start Date <input type="date" name="start_date" value="{{ session.start_date }}"></label></div>
  <div><label>End Date <input type="date" name="end_date" value="{{ session.end_date }}"></label></div>
  <div><label>Daily Start Time <input type="time" name="daily_start_time" value="{{ session.daily_start_time }}"></label></div>
  <div><label>Daily End Time <input type="time" name="daily_end_time" value="{{ session.daily_end_time }}"></label></div>
  <div><label>Timezone <input type="text" name="timezone" value="{{ session.timezone }}"></label></div>
  <div><label>Location <input type="text" name="location" value="{{ session.location }}"></label></div>
  <div><label>Delivery Type
    <select name="delivery_type">
      <option value="">--Select--</option>
      {% for opt in ['Onsite','Virtual','Self-paced','Hybrid'] %}
      <option value="{{ opt }}" {% if session and session.delivery_type==opt %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
  </label></div>
  <div><label>Region
    <select name="region">
      <option value="">--Select--</option>
      {% for opt in ['NA','EU','SEA','Other'] %}
      <option value="{{ opt }}" {% if session and session.region==opt %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
  </label></div>
  <div><label>Language
    <select name="language">
      {% for label, code in LANG_CHOICES %}
      <option value="{{ label }}" {% if (session and session.language==label) or (not session and label=='English') %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </label></div>
  <div><label>Capacity <input type="number" name="capacity" value="{{ session.capacity }}"></label></div>
  <div><label>Status <input type="text" name="status" value="{{ session.status }}"></label></div>
  <div><label>Sponsor <input type="text" name="sponsor" value="{{ session.sponsor }}"></label></div>
  <div><label>Notes<br><textarea name="notes">{{ session.notes if session else '' }}</textarea></label></div>
  <div><label>Simulation Outline<br><textarea name="simulation_outline">{{ session.simulation_outline if session else '' }}</textarea></label></div>
  <div><label>Lead Facilitator
    <select name="lead_facilitator_id">
      <option value="">--Select--</option>
      {% for u in facilitators %}
      <option value="{{ u.id }}" {% if session and session.lead_facilitator_id==u.id %}selected{% endif %}>{{ u.full_name or u.email }}</option>
      {% endfor %}
    </select>
  </label></div>
  <div>Additional Facilitators:
    <div id="additional-facilitators">
      {% set adds = session.facilitators if session else [] %}
      {% if adds %}
        {% for fac in adds %}
        <select name="additional_facilitators">
          <option value="">--Select--</option>
          {% for u in facilitators %}
          <option value="{{ u.id }}" {% if u.id==fac.id %}selected{% endif %}>{{ u.full_name or u.email }}</option>
          {% endfor %}
        </select>
        {% endfor %}
      {% else %}
        <select name="additional_facilitators">
          <option value="">--Select--</option>
          {% for u in facilitators %}
          <option value="{{ u.id }}">{{ u.full_name or u.email }}</option>
          {% endfor %}
        </select>
      {% endif %}
    </div>
    <button type="button" id="add-fac">Add another facilitator</button>
  </div>
  <button type="submit">Save</button>
</form>
<script>
  document.getElementById('add-fac').addEventListener('click', function(){
    var container = document.getElementById('additional-facilitators');
    var select = container.querySelector('select').cloneNode(true);
    select.value='';
    container.appendChild(select);
  });
</script>
{% endblock %}
