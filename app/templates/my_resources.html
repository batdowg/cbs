{% extends 'base.html' %}
{% block title %}My Resources{% endblock %}
{% block content %}
<h1>My Resources</h1>
{% if grouped %}
  {% for wt, items in grouped %}
    <section class="resource-group">
      <h2>{{ wt.name }}</h2>
      <div class="resource-list">
      {% for r in items %}
        {% set public_url = r.public_url %}
        {% set filename = r.document_filename or (r.resource_value.rsplit('/', 1)[-1] if r.resource_value else '') %}
        {% set ext = filename.rsplit('.', 1)[-1]|lower if '.' in filename else '' %}
        {% set is_image = ext in ['png', 'jpg', 'jpeg', 'gif', 'bmp', 'svg', 'webp'] %}
        {% set is_pdf = ext == 'pdf' %}
        <details class="resource-item">
          <summary class="resource-summary">{{ r.name }}</summary>
          <div class="resource-panel">
            <div class="resource-tile">
              {% if r.type == 'DOCUMENT' and public_url %}
                <a href="{{ public_url }}" download class="resource-file-link">
                  {% if is_image %}
                    <img src="{{ public_url }}" alt="" class="resource-thumb">
                  {% else %}
                    <span class="resource-icon" aria-hidden="true">
                      {% if is_pdf %}
                        üìÑ
                      {% else %}
                        ‚¨áÔ∏è
                      {% endif %}
                    </span>
                  {% endif %}
                  <span class="resource-file-text">
                    <span class="resource-file-name">{{ filename or r.name }}</span>
                    <span class="resource-file-meta">
                      {% if is_image %}
                        Download image
                      {% elif is_pdf %}
                        Download PDF
                      {% else %}
                        Download file
                      {% endif %}
                    </span>
                  </span>
                </a>
              {% else %}
                <span class="resource-icon" aria-hidden="true">üîó</span>
                {% if r.resource_value %}
                  <a href="{{ r.resource_value }}" target="_blank" rel="noopener" class="btn btn-primary">Open resource</a>
                {% else %}
                  <span class="resource-file-name">No file uploaded.</span>
                {% endif %}
              {% endif %}
            </div>
            {% if r.description_html %}
              <div class="resource-description rich-text">
                {{ r.description_html | safe }}
              </div>
            {% endif %}
          </div>
        </details>
      {% endfor %}
      </div>
    </section>
  {% endfor %}
{% else %}
  <p>No resources available.</p>
{% endif %}
{% endblock %}
