{% extends 'base.html' %}
{% block title %}Materials Dashboard{% endblock %}
{% block content %}
{% set breadcrumbs = [{'href': url_for('home'), 'label': 'Home'}, {'label': 'Materials Dashboard'}] %}
<h1>Materials Dashboard</h1>
{% include 'shared/_breadcrumbs.html' %}
<form method="get">
  <label>Client
    <select name="client_id">
      <option value="">All</option>
      {% for c in clients %}
        <option value="{{ c.id }}" {% if client_id==c.id %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>
  </label>
  <label>Order Type
    <select name="order_type">
      <option value="">All</option>
      {% for ot in order_types %}
        <option value="{{ ot }}" {% if order_type==ot %}selected{% endif %}>{{ ot }}</option>
      {% endfor %}
    </select>
  </label>
  <label>Status
    <select name="status">
      <option value="">All</option>
      {% for st in statuses %}
        <option value="{{ st }}" {% if status==st %}selected{% endif %}>{{ st }}</option>
      {% endfor %}
    </select>
  </label>
  <button type="submit">Filter</button>
</form>
<p>
  {% if show_closed %}
    <a href="{{ url_for('materials_orders.list_orders', client_id=client_id, order_type=order_type, status=status) }}">Hide closed sessions</a>
  {% else %}
    <a href="{{ url_for('materials_orders.list_orders', client_id=client_id, order_type=order_type, status=status, closed=1) }}">Show closed sessions</a>
  {% endif %}
</p>
{% set base = '' %}
{% if client_id %}{% set base = base + '&client_id=' + client_id|string %}{% endif %}
{% if order_type %}{% set base = base + '&order_type=' + order_type|urlencode %}{% endif %}
{% if status %}{% set base = base + '&status=' + status %}{% endif %}
{% if show_closed %}{% set base = base + '&closed=1' %}{% endif %}
<div class="kt-table-wrapper">
<table class="kt-table">
  <tr>
    <th><a href="?sort=title{{ base }}">Workshop title</a></th>
    <th><a href="?sort=client{{ base }}">Client</a></th>
    <th><a href="?sort=workshop_type{{ base }}">Workshop</a></th>
    <th><a href="?sort=arrival_date{{ base }}">Latest Arrival Date</a></th>
    <th><a href="?sort=order_type{{ base }}">Materials Order type</a></th>
    <th><a href="?sort=materials_status{{ base }}">Materials order status</a></th>
    <th><a href="?sort=session_status{{ base }}">Workshop status</a></th>
  </tr>
  {% for row in rows %}
  <tr>
    <td><a href="{{ url_for('materials.materials_view', session_id=row.session_id)}}">{{ row.title }}</a></td>
    <td>{{ row.client }}</td>
    <td>{{ row.workshop_type }}</td>
    <td>{{ row.arrival_date }}</td>
    <td>{{ row.order_type }}</td>
    <td><span class="pill pill--{{ row.materials_status|lower|replace(' ', '') }}">{{ row.materials_status }}</span></td>
    <td><span class="pill pill--{{ row.session_status|lower|replace(' ', '') }}">{{ row.session_status }}</span></td>
  </tr>
  {% endfor %}
</table>
</div>
{% endblock %}
