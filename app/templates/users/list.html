{% extends 'base.html' %}
{% block title %}Users{% endblock %}
{% block content %}
{% with msgs = get_flashed_messages(with_categories=true) %}
  {% if msgs %}<ul class="flashes">{% for cat,msg in msgs %}<li class="{{cat}}">{{msg}}</li>{% endfor %}</ul>{% endif %}
{% endwith %}
<h1>Users</h1>
<p><a href="{{ url_for('users.new_user') }}">New User</a> | <a href="#" id="role-matrix-link">Role Matrix</a></p>
<form method="post" action="{{ url_for('users.bulk_update') }}">
<table>
  <tr>
    <th>Email</th>
    <th>Full Name</th>
    <th>SysAdmin</th>
    <th>Administrator</th>
    <th>CRM</th>
    <th>KT Facilitator</th>
    <th>Contractor</th>
  </tr>
  {% for u in users %}
  <tr>
    <td>{{ u.email }}</td>
    <td>{{ u.full_name }}</td>
    <td><input type="checkbox" name="is_app_admin_{{ u.id }}" {% if u.is_app_admin %}checked{% endif %} {% if not current_user.is_app_admin %}disabled{% endif %}></td>
    <td><input type="checkbox" name="is_admin_{{ u.id }}" {% if u.is_admin %}checked{% endif %}></td>
    <td><input type="checkbox" name="is_kcrm_{{ u.id }}" {% if u.is_kcrm %}checked{% endif %}></td>
    <td><input type="checkbox" name="is_kt_delivery_{{ u.id }}" {% if u.is_kt_delivery %}checked{% endif %}></td>
    <td><input type="checkbox" name="is_kt_contractor_{{ u.id }}" {% if u.is_kt_contractor %}checked{% endif %}></td>
  </tr>
  {% endfor %}
</table>
<p><button type="submit">Save changes</button></p>
</form>

<div id="role-matrix-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);">
  <div class="modal-content" style="background:#fff;margin:10% auto;padding:1rem;max-width:800px;overflow:auto;">
    <button id="role-matrix-close" style="float:right;">Close</button>
    <h2>Role Matrix</h2>
    <table border="1" cellpadding="4" cellspacing="0">
      <tr><th>Action</th><th>SysAdmin</th><th>Administrator</th><th>CRM</th><th>KT Facilitator</th><th>Contractor</th><th>CSA*</th></tr>
      <tr><td>System Settings (SMTP, etc)</td><td>&#10003;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td></tr>
      <tr><td>Manage Users (create/edit/remove)</td><td>&#10003;</td><td>&#10003;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td></tr>
      <tr><td>Toggle SysAdmin</td><td>&#10003;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td></tr>
      <tr><td>Workshop Types CRUD</td><td>&#10003;</td><td>&#10003;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td></tr>
      <tr><td>Clients CRUD</td><td>&#10003;</td><td>&#10003;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td></tr>
      <tr><td>Sessions Create</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td></tr>
      <tr><td>Sessions Edit</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&ndash;</td></tr>
      <tr><td>Sessions Delete</td><td>&#10003;</td><td>&#10003;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td><td>&ndash;</td></tr>
      <tr><td>Participants Add/Edit/Remove</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003; (assigned sessions only)</td></tr>
      <tr><td>Confirm Delivery Complete</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&ndash;</td></tr>
      <tr><td>Generate Certificates**</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&ndash;</td></tr>
    </table>
    <p>*CSA is per-session, assigned on the Session page.<br>**Only when “Delivered” is checked.</p>
  </div>
</div>

<script>
document.getElementById('role-matrix-link').addEventListener('click', function(ev){
  ev.preventDefault();
  document.getElementById('role-matrix-modal').style.display = 'block';
});
document.getElementById('role-matrix-close').addEventListener('click', function(){
  document.getElementById('role-matrix-modal').style.display = 'none';
});
</script>
{% endblock %}

