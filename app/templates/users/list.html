{% extends 'base.html' %}
{% from 'macros/filters.html' import clear_filters_link %}
{% block title %}Users{% endblock %}
{% block content %}
{% set breadcrumbs = [{'href': url_for('home'), 'label': 'Home'}, {'label': 'Users'}] %}
<h1>Users</h1>
{% include 'shared/_breadcrumbs.html' %}
<p><a class="btn btn-success" href="{{ url_for('users.new_user') }}">New User</a> | <a href="#" id="role-matrix-link">Role Matrix</a></p>

<form method="get" action="{{ url_for('users.list_users') }}" data-autofilter="true">
  <input type="text" name="q" value="{{ q }}" placeholder="Search" autocomplete="off">
  <select name="region" autocomplete="off">
    <option value="" {% if not region %}selected{% endif %}>All Regions</option>
    <option value="NA" {% if region=='NA' %}selected{% endif %}>NA</option>
    <option value="EU" {% if region=='EU' %}selected{% endif %}>EU</option>
    <option value="SEA" {% if region=='SEA' %}selected{% endif %}>SEA</option>
    <option value="Other" {% if region=='Other' %}selected{% endif %}>Other</option>
  </select>
</form>

<p class="filter-clear">{{ clear_filters_link(url_for('users.list_users')) }}</p>

<form method="post" action="{{ url_for('users.bulk_update') }}" data-dirty-guard="true">
<div class="kt-table-wrapper">
  <table class="kt-table">
    <thead>
      <tr>
        <th scope="col">First Name</th>
        <th scope="col">Last Name</th>
        <th scope="col">Email</th>
        <th scope="col">Region</th>
        <th scope="col">SysAdmin</th>
        <th scope="col">Administrator</th>
        <th scope="col">CRM</th>
        <th scope="col">Certificate Manager</th>
        <th scope="col">KT Facilitator</th>
        <th scope="col">Contractor</th>
        <th scope="col">Edit</th>
      </tr>
    </thead>
    <tbody>
      {% if users %}
        {% for u in users %}
        <tr>
          <td>{{ u.first_name }}</td>
          <td>{{ u.last_name }}</td>
          <td>{{ u.email }}</td>
          <td>{{ u.region }}</td>
          <td><input type="checkbox" name="is_app_admin_{{ u.id }}" {% if u.is_app_admin %}checked{% endif %} {% if not current_user.is_app_admin %}disabled{% endif %}></td>
          <td><input type="checkbox" name="is_admin_{{ u.id }}" {% if u.is_admin %}checked{% endif %}></td>
          <td><input type="checkbox" name="is_kcrm_{{ u.id }}" {% if u.is_kcrm %}checked{% endif %}></td>
          <td><input type="checkbox" name="is_certificate_manager_{{ u.id }}" {% if u.is_certificate_manager %}checked{% endif %}></td>
          <td><input type="checkbox" name="is_kt_delivery_{{ u.id }}" {% if u.is_kt_delivery %}checked{% endif %}></td>
          <td><input type="checkbox" name="is_kt_contractor_{{ u.id }}" {% if u.is_kt_contractor %}checked{% endif %}></td>
          <td><a href="{{ url_for('users.edit_user', user_id=u.id) }}">Edit</a></td>
        </tr>
        {% endfor %}
      {% else %}
        {% with colspan=11 %}

          {% include 'shared/_table_empty.html' %}

        {% endwith %}
      {% endif %}
    </tbody>
  </table>
</div>
<p><button type="submit">Save changes</button></p>
</form>
{% include 'users/role_matrix.html' %}
{% endblock %}

