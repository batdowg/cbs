{% extends 'base.html' %}
{% block title %}Users{% endblock %}
{% block content %}
{% set breadcrumbs = [{'href': url_for('home'), 'label': 'Home'}, {'label': 'Users'}] %}
<h1>Users</h1>
{% include 'shared/_breadcrumbs.html' %}
<p><a class="btn btn-success" href="{{ url_for('users.new_user') }}">New User</a> | <a href="#" id="role-matrix-link">Role Matrix</a></p>

<form method="get" action="{{ url_for('users.list_users') }}">
  <input type="text" name="q" value="{{ q }}" placeholder="Search" autocomplete="off">
  <select name="region" autocomplete="off">
    <option value="" {% if not region %}selected{% endif %}>All Regions</option>
    <option value="NA" {% if region=='NA' %}selected{% endif %}>NA</option>
    <option value="EU" {% if region=='EU' %}selected{% endif %}>EU</option>
    <option value="SEA" {% if region=='SEA' %}selected{% endif %}>SEA</option>
    <option value="Other" {% if region=='Other' %}selected{% endif %}>Other</option>
  </select>
  <button type="submit">Filter</button>
</form>

<form method="post" action="{{ url_for('users.bulk_update') }}">
<div class="kt-table-wrapper">
<table class="kt-table">
  <tr>
    <th>Email</th>
    <th>Full Name</th>
    <th>Region</th>
    <th>SysAdmin</th>
    <th>Administrator</th>
    <th>CRM</th>
    <th>KT Facilitator</th>
    <th>Contractor</th>
    <th class="col-actions">Edit</th>
  </tr>
  {% for u in users %}
  <tr>
    <td>{{ u.email }}</td>
    <td>{{ u.full_name }}</td>
    <td>{{ u.region }}</td>
    <td><input type="checkbox" name="is_app_admin_{{ u.id }}" {% if u.is_app_admin %}checked{% endif %} {% if not current_user.is_app_admin %}disabled{% endif %}></td>
    <td><input type="checkbox" name="is_admin_{{ u.id }}" {% if u.is_admin %}checked{% endif %}></td>
    <td><input type="checkbox" name="is_kcrm_{{ u.id }}" {% if u.is_kcrm %}checked{% endif %}></td>
    <td><input type="checkbox" name="is_kt_delivery_{{ u.id }}" {% if u.is_kt_delivery %}checked{% endif %}></td>
    <td><input type="checkbox" name="is_kt_contractor_{{ u.id }}" {% if u.is_kt_contractor %}checked{% endif %}></td>
    <td class="col-actions"><a class="btn btn-sm" href="{{ url_for('users.edit_user', user_id=u.id) }}">Edit</a></td>
  </tr>
  {% endfor %}
  </table>
</div>
<p><button type="submit">Save changes</button></p>
</form>
{% include 'users/role_matrix.html' %}
{% endblock %}

