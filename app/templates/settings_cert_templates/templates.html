{% extends 'base.html' %}
{% block title %}Template Mapping{% endblock %}
{% block content %}
<h1>Template Mapping for {{ series.name }} ({{ series.code }})</h1>
<div style="margin-bottom: 1em;">
  <form method="post" action="{{ url_for('settings_cert_templates.upload_pdfs', series_id=series.id) }}" enctype="multipart/form-data" style="display:inline;">
    <input type="file" id="pdf_files" name="files" accept=".pdf" multiple style="display:none" onchange="this.form.submit()">
    <button type="button" onclick="document.getElementById('pdf_files').click()">Upload certificate templates (PDFs)</button>
  </form>
  <form method="post" action="{{ url_for('settings_cert_templates.upload_badges', series_id=series.id) }}" enctype="multipart/form-data" style="display:inline; margin-left: 0.5em;">
    <input type="file" id="badge_files" name="files" accept=".webp" multiple style="display:none" onchange="this.form.submit()">
    <button type="button" onclick="document.getElementById('badge_files').click()">Upload badges (WEBP)</button>
  </form>
</div>
<form method="post">
  <table class="kt-table">
    <tr><th>Language</th><th>A4</th><th>Letter</th><th>Badge</th></tr>
    {% for code, name in languages %}
    <tr>
      <td>{{ name }}</td>
      {% for size in ['A4','LETTER'] %}
      <td>
        <select name="{{ code }}_{{ size }}">
          <option value=""></option>
          {% for file in files %}
            <option value="{{ file }}" {% if mapping.get((code, size)) == file %}selected{% endif %}>{{ file }}</option>
          {% endfor %}
        </select>
      </td>
      {% endfor %}
      <td>
        <select name="badge_{{ code }}">
          <option value="">— None —</option>
          {% for badge in badges %}
            <option value="{{ badge }}" {% if badge_mapping.get(code) == badge %}selected{% endif %}>{{ badge }}</option>
          {% endfor %}
        </select>
        {% set current_badge = badge_mapping.get(code) %}
        {% if current_badge %}
          <br><small><a href="/badges/{{ current_badge }}">Current file</a></small>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </table>
  <p><button type="submit">Save</button></p>
</form>
{% endblock %}
