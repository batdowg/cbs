<h2 id="defaults">Default Materials</h2>
<table class="kt-table" id="defaults-table">
  <thead>
    <tr><th scope="col">Delivery Type</th><th scope="col">Region</th><th scope="col">Language</th><th scope="col">Material Item</th><th scope="col">Default Format</th><th scope="col">Active</th><th scope="col">Actions</th></tr>
  </thead>
  <tbody>
  {% for d in defaults %}
  <tr data-row="{{ d.id }}"{% if loop.last %} data-blank-row="true"{% endif %}>
    <td>
      <select name="defaults[{{ d.id }}][delivery_type]" class="delivery-select" data-row="{{ d.id }}">
        {% for opt in delivery_choices %}
        <option value="{{ opt }}" {% if d.delivery_type==opt %}selected{% endif %}>{{ opt }}</option>
        {% endfor %}
      </select>
    </td>
    <td>
      <select name="defaults[{{ d.id }}][region_code]">
        {% for code,label in regions %}
        <option value="{{ code }}" {% if d.region_code==code %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </td>
    <td>
      <select name="defaults[{{ d.id }}][language]" class="lang-select" data-row="{{ d.id }}">
        {% for code,label in language_options if code in supported_langs %}
        <option value="{{ code }}" {% if d.language==code %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </td>
    <td>
      {% set sel = selected_opts.get(d.id) %}
      <select name="defaults[{{ d.id }}][material_option_id]" class="material-select" data-row="{{ d.id }}">
        <option value=""></option>
        {% if sel %}<option value="{{ sel.id }}" selected>{{ sel.label }}</option>{% endif %}
      </select>
    </td>
    <td>
      <select name="defaults[{{ d.id }}][default_format]">
        {% for opt in format_choices %}
        <option value="{{ opt }}" {% if d.default_format==opt %}selected{% endif %}>{{ opt }}</option>
        {% endfor %}
      </select>
    </td>
    <td><input type="checkbox" name="defaults[{{ d.id }}][active]" {% if d.active %}checked{% endif %}></td>
    <td>{% if not loop.last %}<button type="button" class="btn btn-sm btn-danger delete-default" data-id="{{ d.id }}" data-url="{{ url_for('workshop_types.delete_default_row', default_id=d.id) }}">Delete</button>{% endif %}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
<template id="default-row-template">
  <tr data-row="__index__" data-blank-row="true">
    <td>
      <select name="defaults[__index__][delivery_type]" class="delivery-select" data-row="__index__">
        {% for opt in delivery_choices %}
        <option value="{{ opt }}">{{ opt }}</option>
        {% endfor %}
      </select>
    </td>
    <td>
      <select name="defaults[__index__][region_code]">
        {% for code,label in regions %}
        <option value="{{ code }}">{{ label }}</option>
        {% endfor %}
      </select>
    </td>
    <td>
      <select name="defaults[__index__][language]" class="lang-select" data-row="__index__">
        {% for code,label in language_options if code in supported_langs %}
        <option value="{{ code }}">{{ label }}</option>
        {% endfor %}
      </select>
    </td>
    <td>
      <select name="defaults[__index__][material_option_id]" class="material-select" data-row="__index__">
        <option value=""></option>
      </select>
    </td>
    <td>
      <select name="defaults[__index__][default_format]">
        {% for opt in format_choices %}
        <option value="{{ opt }}">{{ opt }}</option>
        {% endfor %}
      </select>
    </td>
    <td><input type="checkbox" name="defaults[__index__][active]" checked></td>
    <td></td>
  </tr>
</template>
