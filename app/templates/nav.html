{% macro render_item(item) %}
  {% set is_active = item.endpoint and request.endpoint == item.endpoint %}
  {% if item.children %}
    <details class="{{ item.id }}">
      <summary class="nav-link{% if is_active %} active{% endif %}" {% if is_active %}aria-current="page"{% endif %}>{{ item.label }}</summary>
      <ul>
      {% for child in item.children %}
        <li>{{ render_item(child) }}</li>
      {% endfor %}
      </ul>
    </details>
  {% else %}
    <a href="{{ url_for(item.endpoint, **(item.args or {})) }}"{% if is_active %} class="active" aria-current="page"{% endif %}>{{ item.label }}</a>
  {% endif %}
{% endmacro %}
<nav class="kt-nav">
  <a href="/{{''}}"><img src="{{ url_for('static', filename='ktlogo1.png') }}" onerror="this.onerror=null;this.src='/logo.png';" alt="KT Logo" style="max-height:48px;"></a>
  {% for item in nav_menu %}
    {{ render_item(item) }}
  {% endfor %}
  {% if view_options|length > 1 %}
  <form method="post" action="{{ url_for('settings_view') }}" class="kt-sidebar-footer">
    <label>View:</label>
    <select name="view" onchange="this.form.submit()">
      {% for opt in view_options %}
      {% set label = 'Session Admin' if opt == 'CSA' else opt.replace('_', ' ').title() %}
      <option value="{{ opt }}" {% if opt == active_view %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </form>
  {% endif %}
</nav>
