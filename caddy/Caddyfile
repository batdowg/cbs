cbs.ktapps.net {
  encode zstd gzip
  root * /srv

  # Let Flask serve /static/*
  # (do NOT add a /static handler)

  # Serve certificate assets directly except for dynamic staff routes.
  @certificates_new {
    path /certificates/new
    path /certificates/new/*
  }
  handle @certificates_new {
    reverse_proxy app:8000
  }
  @certificate_assets {
    path /certificates/*
    not {
      path /certificates/new
      path /certificates/new/*
    }
  }
  handle @certificate_assets {
    file_server
  }
  handle /resources/* {
    file_server
  }
  handle /badges/* {
    file_server
  }

  @health path /healthz
  reverse_proxy @health app:8000
  handle {
    reverse_proxy app:8000
  }
}
